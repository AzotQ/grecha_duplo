<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NFT-Репутационный лидерборд</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* оставляем ваши стили из LUDO-GRECHA */
    </style>
</head>
<body>
<h1>NFT Reputation Leaderboard</h1>
<div id="leaderboard">
    <div class="leaderboard-header">
        <div class="col-1">№</div>
        <div class="col-2">Sender</div>
        <div class="col-3">Sum of Reputation</div>
    </div>
    <div id="items"></div>
</div>

<script>
    const API_PATH      = '/api/nft-reputation';
    const WALLET_ID     = 'azotq.tg';
    const LIMIT         = 200;
    const MIN_INTERVAL  = 5 * 60 * 1000; // 5 минут
    let lastFetchTime   = 0;

    async function fetchAll() {
        const now = Date.now();
        if (now - lastFetchTime < MIN_INTERVAL) return [];
        lastFetchTime = now;

        const container = document.getElementById('items');
        container.innerHTML = '';

        try {
            const resp = await fetch(`${API_PATH}?wallet_id=${encodeURIComponent(WALLET_ID)}&limit=${LIMIT}&skip=0`);
            if (!resp.ok) throw new Error(`API ${resp.status}`);
            const { leaderboard } = await resp.json();

            if (!leaderboard.length) {
                container.innerHTML = `<div class="error">Нет репутационных баллов за последние трансферы.</div>`;
                return;
            }

            leaderboard.forEach((item, i) => {
                const row = document.createElement('div');
                row.className = 'leaderboard-item';
                row.innerHTML = `
            <div class="col-1">${i+1}</div>
            <div class="col-2">${item.wallet}</div>
            <div class="col-3">${item.total.toLocaleString(undefined, {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                })}</div>
          `;
                container.appendChild(row);
            });

        } catch (err) {
            container.innerHTML = `<div class="error">Ошибка: ${err.message}</div>`;
            console.error(err);
        }
    }

    window.addEventListener('DOMContentLoaded', fetchAll);
</script>
</body>
</html>
